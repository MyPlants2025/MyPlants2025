<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#2c3e50">
  <title>Ø³Ø¬Ù„ Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø¨ÙŠØ¯Ø§Øª | Store Stock</title>
  <link rel="manifest" href="manifest.json">
  <!-- Ø®Ø· Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ø¶Ø­ Ù„Ø¯Ø¹Ù… Ø§Ù„Ù„ØºØ© ÙÙŠ PDF -->
  <link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #2ecc71;
      --danger: #e74c3c;
      --warning: #f39c12;
      --light: #f4f4f9;
      --shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', 'Tahoma', sans-serif;
    }

    body {
      background-color: var(--light);
      color: var(--dark);
      line-height: 1.7;
      direction: rtl;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      margin-bottom: 30px;
    }

    header h1 {
      color: var(--primary);
      font-size: 1.8rem;
      margin-bottom: 10px;
    }

    .language-button {
      position: fixed;
      top: 20px;
      left: 20px;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      transition: background 0.3s;
    }

    .language-button:hover {
      background-color: #1a252f;
    }

    .input-group {
      margin: 20px 0;
      text-align: center;
    }

    .input-group input {
      padding: 12px;
      font-size: 16px;
      width: 280px;
      border: 1px solid #ddd;
      border-radius: 8px;
      outline: none;
      margin: 5px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      margin: 5px;
      transition: background 0.3s;
    }

    .store-button {
      background-color: var(--secondary);
      color: white;
    }

    .store-button:hover {
      background-color: #2980b9;
    }

    .add-button {
      background-color: var(--success);
      color: white;
    }

    .add-button:hover {
      background-color: #27ae60;
    }

    .delete-button {
      background-color: var(--danger);
      color: white;
    }

    .delete-button:hover {
      background-color: #c0392b;
    }

    .date-button {
      background-color: #9b59b6;
      color: white;
    }

    .date-button:hover {
      background-color: #8e44ad;
    }

    .button {
      background-color: var(--success);
      color: white;
    }

    .button:hover {
      background-color: #27ae60;
    }

    .edit-button {
      background-color: var(--warning);
      color: white;
    }

    .edit-button:hover {
      background-color: #e67e22;
    }

    .delete-inventory-button {
      background-color: #c0392b;
      color: white;
    }

    .delete-inventory-button:hover {
      background-color: #a93226;
    }

    .pdf-button {
      background-color: #8e44ad;
      color: white;
    }

    .pdf-button:hover {
      background-color: #7d3c98;
    }

    .hidden {
      display: none !important;
    }

    table {
      width: 100%;
      margin: 20px auto;
      border-collapse: collapse;
      background-color: white;
      box-shadow: var(--shadow);
      border-radius: 12px;
      overflow: hidden;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 14px;
      text-align: center;
    }

    th {
      background-color: var(--secondary);
      color: white;
    }

    tbody tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .current-date {
      font-size: 18px;
      margin: 15px 0;
      color: var(--dark);
      font-weight: bold;
    }

    .past-date {
      color: var(--secondary);
      text-decoration: underline;
      cursor: pointer;
      font-weight: bold;
    }

    .person-info {
      font-size: 14px;
      color: #555;
      margin-top: 5px;
    }

    .actions {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }

    footer {
      text-align: center;
      margin-top: 60px;
      padding: 20px;
      background-color: var(--primary);
      color: white;
      font-size: 14px;
      border-top: 3px solid var(--secondary);
    }

    footer a {
      color: var(--secondary);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>

  <!-- Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© -->
  <button class="language-button" id="languageButton">English</button>

  <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <div id="mainPage" class="container">
    <header>
      <h1 data-ar="Ø³Ø¬Ù„ Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø¨ÙŠØ¯Ø§Øª" data-en="Store Stock">Ø³Ø¬Ù„ Ù…Ø®Ø²Ù† Ø§Ù„Ù…Ø¨ÙŠØ¯Ø§Øª</h1>
      <p data-ar="Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø°ÙƒÙŠ" data-en="Smart Store Inventory System">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø§Ø²Ù† Ø§Ù„Ø°ÙƒÙŠ</p>
    </header>

    <div class="input-group">
      <input type="text" id="storeName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø²Ù†" data-ar-placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø²Ù†" data-en-placeholder="Enter store name" />
      <button class="add-button" onclick="addStore()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø²Ù†</button>
    </div>

    <div id="storesList"></div>

    <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¯Ø§Øª -->
    <h2 data-ar="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¯Ø§Øª" data-en="Pesticide Management" style="text-align:center; margin:20px 0; color:var(--primary);">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¯Ø§Øª</h2>
    <div class="input-group">
      <input type="text" id="pesticideName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¨ÙŠØ¯" data-ar-placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¨ÙŠØ¯" data-en-placeholder="Enter pesticide name" />
      <button class="add-button" onclick="addPesticide()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¨ÙŠØ¯</button>
      <button class="delete-button" onclick="deletePesticideByName()">ğŸ—‘ï¸ Ø­Ø°Ù Ù…Ø¨ÙŠØ¯</button>
    </div>
  </div>

  <!-- ØµÙØ­Ø© Ø§Ù„Ø¬Ø±Ø¯ -->
  <div id="inventoryPage" class="container hidden">
    <button class="button" onclick="goBack()">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
    <h1 id="storeTitle" style="text-align:center; color:var(--primary); margin:20px 0;"></h1>

    <div class="actions">
      <button class="button" onclick="newInventory()">ğŸ†• Ø¬Ø±Ø¯ Ø¬Ø¯ÙŠØ¯</button>
      <button class="button" onclick="viewPastInventories()">ğŸ“‹ Ø¹Ù…Ù„ÙŠØ§Øª Ø¬Ø±Ø¯ Ø³Ø§Ø¨Ù‚Ø©</button>
    </div>

    <!-- Ù‚Ø³Ù… Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
    <div id="newInventorySection" class="hidden">
      <h2 data-ar="Ø¬Ø±Ø¯ Ø¬Ø¯ÙŠØ¯" data-en="New Inventory" style="text-align:center; margin:20px 0;">Ø¬Ø±Ø¯ Ø¬Ø¯ÙŠØ¯</h2>
      <div class="input-group">
        <input type="text" id="personName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ø¬Ø±Ø¯" data-ar-placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ Ø¹Ù† Ø§Ù„Ø¬Ø±Ø¯" data-en-placeholder="Person in charge" />
      </div>
      <button class="date-button" onclick="recordTodayDate()">ğŸ“… ØªØ³Ø¬ÙŠÙ„ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…</button>
      <div id="currentDateDisplay" class="current-date"></div>

      <table id="inventoryTable">
        <thead>
          <tr>
            <th data-ar="Ø§Ø³Ù… Ø§Ù„Ù…Ø¨ÙŠØ¯" data-en="Pesticide Name">Ø§Ø³Ù… Ø§Ù„Ù…Ø¨ÙŠØ¯</th>
            <th data-ar="Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©" data-en="Current Quantity">Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <button class="button" onclick="saveInventory()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¬Ø±Ø¯</button>
    </div>

    <!-- Ù‚Ø³Ù… Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© -->
    <div id="pastInventoriesSection" class="hidden">
      <h2 data-ar="Ø¹Ù…Ù„ÙŠØ§Øª Ø¬Ø±Ø¯ Ø³Ø§Ø¨Ù‚Ø©" data-en="History" style="text-align:center; margin:20px 0;">Ø¹Ù…Ù„ÙŠØ§Øª Ø¬Ø±Ø¯ Ø³Ø§Ø¨Ù‚Ø©</h2>
      <ul id="pastInventoriesList" style="list-style:none; padding:0;"></ul>
    </div>
  </div>

  <!-- Ø§Ù„ÙÙˆØªØ± -->
  <footer>
    ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ø¨ÙˆØ§Ø³Ø·Ø© <a href="mailto:example@example.com" target="_blank">Ù….Ø£Ø­Ù…Ø¯ Ø§Ù„Ù…Ø¹Ø´Ù†ÙŠ</a> &copy; 2025
  </footer>

  <!-- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

  <script>
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… localStorage
    if (typeof localStorage === 'undefined') {
      alert('Ù…ØªØµÙØ­Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ.');
    }

    // Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
    let pesticides = JSON.parse(localStorage.getItem('pesticides')) || [
      "Actara", "Avaunt", "Benevia", "Cal-Ex Avance", "Coragen", "Decis Expert", "Evisect", "Floramite",
      "Green Lambada", "Karate Zeon", "Milbeknock", "Mospilan", "Movento", "Ortus", "Plesiva Pro", "Radiant",
      "Sivanto Prime", "Starkle", "Sumi Alpha", "Tracer", "Trebon", "Tripsol", "Vertimec", "Voliam Flexi",
      "Vydate", "Hallmark", "Triclopyer", "Amistar Top", "Armetil C", "Curenox", "Equation", "Kocide",
      "Luna Sensation", "Miravise", "Ortiva", "Previcur Energy", "Score", "Top Guard", "Uniform",
      "Bio Cure-B", "Bio Cure-F", "Bio Catch", "Bio Power", "Mustard Oil", "Nimbecidine", "Xen Tari", "Dome Soap", "Sluge Killer"
    ];
    let currentStore = '';
    let inventories = JSON.parse(localStorage.getItem('inventories')) || [];
    let currentDate = '';
    let isEnglish = false;

    // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    function saveData() {
      try {
        localStorage.setItem('pesticides', JSON.stringify(pesticides));
        localStorage.setItem('inventories', JSON.stringify(inventories));
      } catch (e) {
        alert('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø§Ù„Ø¬Ù‡Ø§Ø² Ù…Ù…ØªÙ„Ø¦ Ø£Ùˆ Ø§Ù„Ù…ØªØµÙØ­ Ù‚Ø¯ÙŠÙ….');
      }
    }

    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù„ØºØ©
    document.getElementById('languageButton').addEventListener('click', () => {
      isEnglish = !isEnglish;
      updateLanguage();
      document.getElementById('languageButton').textContent = isEnglish ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'English';
    });

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØµÙˆØµ
    function updateLanguage() {
      document.querySelectorAll('[data-ar], [data-en]').forEach(el => {
        el.textContent = isEnglish ? el.getAttribute('data-en') : el.getAttribute('data-ar');
      });
      document.querySelectorAll('[data-ar-placeholder], [data-en-placeholder]').forEach(el => {
        el.placeholder = isEnglish ? el.getAttribute('data-en-placeholder') : el.getAttribute('data-ar-placeholder');
      });
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø¨ÙŠØ¯
    function addPesticide() {
      const name = document.getElementById('pesticideName').value.trim();
      if (!name) return alert(isEnglish ? 'Enter a valid name.' : 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ù‹Ø§ ØµØ§Ù„Ø­Ù‹Ø§.');
      if (pesticides.includes(name)) return alert(isEnglish ? 'Already exists.' : 'Ø§Ù„Ù…Ø¨ÙŠØ¯ Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§.');
      pesticides.push(name);
      saveData();
      alert(isEnglish ? `Added: ${name}` : `ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©: ${name}`);
      document.getElementById('pesticideName').value = '';
    }

    // Ø­Ø°Ù Ù…Ø¨ÙŠØ¯
    function deletePesticideByName() {
      const name = document.getElementById('pesticideName').value.trim();
      if (!name) return alert(isEnglish ? 'Enter a name to delete.' : 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ù‹Ø§ Ù„Ù„Ø­Ø°Ù.');
      if (!pesticides.includes(name)) return alert(isEnglish ? 'Not found.' : 'ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.');
      if (!confirm(isEnglish ? `Delete ${name}?` : `Ø­Ø°Ù ${name}ØŸ`)) return;
      pesticides = pesticides.filter(p => p !== name);
      saveData();
      alert(isEnglish ? `Deleted: ${name}` : `ØªÙ… Ø§Ù„Ø­Ø°Ù: ${name}`);
      document.getElementById('pesticideName').value = '';
    }

    // Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø²Ù†
    function addStore() {
      const name = document.getElementById('storeName').value.trim();
      if (!name) return alert(isEnglish ? 'Enter store name.' : 'Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø®Ø²Ù†.');
      const storeButton = document.createElement('button');
      storeButton.textContent = name;
      storeButton.className = 'store-button';
      storeButton.onclick = () => showInventoryPage(name);
      document.getElementById('storesList').appendChild(storeButton);
      document.getElementById('storeName').value = '';
    }

    // ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¬Ø±Ø¯
    function showInventoryPage(storeName) {
      currentStore = storeName;
      document.getElementById('mainPage').classList.add('hidden');
      document.getElementById('inventoryPage').classList.remove('hidden');
      document.getElementById('storeTitle').textContent = isEnglish ? `Store: ${storeName}` : `Ø¬Ø±Ø¯ Ø§Ù„Ù…Ø®Ø²Ù†: ${storeName}`;
    }

    // Ø§Ù„Ø±Ø¬ÙˆØ¹
    function goBack() {
      document.getElementById('inventoryPage').classList.add('hidden');
      document.getElementById('mainPage').classList.remove('hidden');
    }

    // Ø¬Ø±Ø¯ Ø¬Ø¯ÙŠØ¯
    function newInventory() {
      document.getElementById('newInventorySection').classList.remove('hidden');
      document.getElementById('pastInventoriesSection').classList.add('hidden');
      document.getElementById('personName').value = '';
      populateInventoryTable();
    }

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
    function recordTodayDate() {
      const today = new Date().toLocaleDateString();
      currentDate = today;
      document.getElementById('currentDateDisplay').textContent = isEnglish ? `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${today}` : `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${today}`;
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
    function viewPastInventories() {
      document.getElementById('newInventorySection').classList.add('hidden');
      document.getElementById('pastInventoriesSection').classList.remove('hidden');
      displayPastInventories();
    }

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¬Ø¯ÙˆÙ„
    function populateInventoryTable() {
      const tbody = document.getElementById('inventoryTable').getElementsByTagName('tbody')[0];
      tbody.innerHTML = '';
      pesticides.forEach(pesticide => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${pesticide}</td>
          <td><input type="number" value="0" min="0" style="width:80px; padding:5px; text-align:center;" /></td>
        `;
      });
    }

    // Ø­ÙØ¸ Ø§Ù„Ø¬Ø±Ø¯
    function saveInventory() {
      if (!currentDate) recordTodayDate();
      const personName = document.getElementById('personName').value.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
      const rows = document.querySelectorAll('#inventoryTable tbody tr');
      const items = Array.from(rows).map(row => ({
        pesticide: row.cells[0].textContent,
        quantity: row.cells[1].querySelector('input').value
      }));
      inventories.push({ date: currentDate, store: currentStore, items, person: personName });
      saveData();
      alert(isEnglish ? 'Saved successfully!' : 'ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­!');
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø±Ø¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
    function displayPastInventories() {
      const list = document.getElementById('pastInventoriesList');
      list.innerHTML = '';
      const filtered = inventories.filter(inv => inv.store === currentStore);
      filtered.forEach((inv, index) => {
        const li = document.createElement('li');
        li.style.margin = '10px 0';
        li.style.padding = '15px';
        li.style.border = '1px solid #ddd';
        li.style.borderRadius = '10px';
        li.style.backgroundColor = 'white';
        li.style.display = 'flex';
        li.style.flexDirection = 'column';
        li.style.alignItems = 'center';
        li.style.gap = '10px';

        const dateSpan = document.createElement('span');
        dateSpan.textContent = inv.date;
        dateSpan.className = 'past-date';
        dateSpan.onclick = () => downloadInventoryPDF(index);

        const personSpan = document.createElement('span');
        personSpan.className = 'person-info';
        personSpan.textContent = isEnglish ? `Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: ${inv.person}` : `Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: ${inv.person}`;

        const buttonsDiv = document.createElement('div');
        buttonsDiv.style.display = 'flex';
        buttonsDiv.style.gap = '10px';

        const editBtn = document.createElement('button');
        editBtn.textContent = isEnglish ? 'Edit' : 'ØªØ¹Ø¯ÙŠÙ„';
        editBtn.className = 'edit-button';
        editBtn.onclick = () => editInventory(index);

        const deleteBtn = document.createElement('button');
        deleteBtn.textContent = isEnglish ? 'Delete' : 'Ø­Ø°Ù';
        deleteBtn.className = 'delete-inventory-button';
        deleteBtn.onclick = () => deleteInventory(index);

        const pdfBtn = document.createElement('button');
        pdfBtn.textContent = isEnglish ? 'PDF' : 'ØªÙ†Ø²ÙŠÙ„ PDF';
        pdfBtn.className = 'pdf-button';
        pdfBtn.onclick = () => downloadInventoryPDF(index);

        buttonsDiv.appendChild(editBtn);
        buttonsDiv.appendChild(deleteBtn);
        buttonsDiv.appendChild(pdfBtn);

        li.appendChild(dateSpan);
        li.appendChild(personSpan);
        li.appendChild(buttonsDiv);
        list.appendChild(li);
      });
    }

    // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¬Ø±Ø¯
    function editInventory(index) {
      const inv = inventories.filter(i => i.store === currentStore)[index];
      if (!inv) return;
      currentDate = inv.date;
      document.getElementById('currentDateDisplay').textContent = isEnglish ? `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${currentDate}` : `Ø§Ù„ØªØ§Ø±ÙŠØ®: ${currentDate}`;
      document.getElementById('personName').value = inv.person;
      populateInventoryTable();
      const rows = document.querySelectorAll('#inventoryTable tbody tr');
      inv.items.forEach(item => {
        const row = Array.from(rows).find(r => r.cells[0].textContent === item.pesticide);
        if (row) row.cells[1].querySelector('input').value = item.quantity;
      });
      document.getElementById('newInventorySection').classList.remove('hidden');
      document.getElementById('pastInventoriesSection').classList.add('hidden');
    }

    // Ø­Ø°Ù Ø§Ù„Ø¬Ø±Ø¯
    function deleteInventory(index) {
      if (!confirm(isEnglish ? 'Delete this inventory?' : 'Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø±Ø¯ØŸ')) return;
      const inv = inventories.filter(i => i.store === currentStore)[index];
      inventories = inventories.filter(i => !(i.store === inv.store && i.date === inv.date && i.person === inv.person));
      saveData();
      displayPastInventories();
      alert(isEnglish ? 'Deleted!' : 'ØªÙ… Ø§Ù„Ø­Ø°Ù!');
    }

    // ØªÙ†Ø²ÙŠÙ„ PDF (ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­)
    function downloadInventoryPDF(index) {
      const inv = inventories.filter(i => i.store === currentStore)[index];
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({
        orientation: 'portrait',
        unit: 'mm',
        format: 'a4'
      });

      // ØªØ¶Ù…ÙŠÙ† Ø®Ø· Ø¹Ø±Ø¨ÙŠ ÙˆØ§Ø¶Ø­
      doc.setFont('Amiri', 'normal');
      doc.setFontSize(20);

      const title = isEnglish ? `Inventory Report - ${inv.date}` : `ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¬Ø±Ø¯ - ${inv.date}`;
      const storeText = isEnglish ? `Ø§Ù„Ù…Ø®Ø²Ù†: ${inv.store}` : `Ø§Ù„Ù…Ø®Ø²Ù†: ${inv.store}`;
      const personText = isEnglish ? `Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: ${inv.person}` : `Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„: ${inv.person}`;
      const headers = isEnglish ? [['Pesticide', 'Quantity']] : [['Ø§Ø³Ù… Ø§Ù„Ù…Ø¨ÙŠØ¯', 'Ø§Ù„ÙƒÙ…ÙŠØ©']];
      const data = inv.items.map(item => [item.pesticide, item.quantity]);

      doc.text(title, 14, 15);
      doc.setFontSize(16);
      doc.text(storeText, 14, 25);
      doc.text(personText, 14, 32);

      doc.autoTable({
        head: headers,
        body: data,
        startY: 40,
        theme: 'grid',
        styles: {
          font: 'Amiri',
          halign: 'right',
          rtl: true,
          fontSize: 12,
          cellPadding: 4
        },
        headStyles: {
          fillColor: [52, 152, 219],
          textColor: 255,
          halign: 'center'
        },
        columnStyles: {
          0: { cellWidth: 'auto' },
          1: { halign: 'center' }
        }
      });

      doc.save(isEnglish ? `Inventory_${inv.date}.pdf` : `Ø¬Ø±Ø¯_${inv.date}.pdf`);
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    window.onload = () => {
      updateLanguage();
      if (inventories.length > 0) viewPastInventories();
    };
  </script>
</body>
</html>
